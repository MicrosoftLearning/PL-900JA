---
lab:
    title: 'ラボ 1: データ モデリング'
    module: 'モジュール 2: Common Data Service の概要'
---

# モジュール 2: Common Data Service の概要
## ラボ: データ モデリング

### 重要なお知らせ (2020 年 11 月より適用):
Common Data Service は、Microsoft Dataverse に名称が変更されました。Microsoft Dataverse の用語が一部更新されました。たとえば、エンティティ (現在は **テーブル**)、フィールド (現在は **列**)、 レコード (現在は **行**) が古くなっていることがあります。このことを念頭に置いて、ラボに取り組んでください。近いうちにコンテンツを最新の状態に更新する予定です。

詳細および対象となる用語の一覧については、[Microsoft Dataverse とは?](https://docs.microsoft.com/ja-jp/powerapps/maker/common-data-service/data-platform-intro#terminology-updates)」をご覧ください。

# シナリオ

ベローズ カレッジは、キャンパス内に複数の建物を持つ教育機関です。キャンパス訪問は現在、紙の記録簿に記録されています。その情報は一貫して把握されておらず、キャンパス全体の訪問に関するデータを収集して分析する手段もありません。 

キャンパスの管理者は、建物へのアクセスがセキュリティ担当者によって管理され、すべての訪問者がホストによって事前に登録され、記録されることが要求される訪問者登録システムを近代化したいと考えています。

このコース全体を通して、アプリケーションを構築するとともに自動化を行って、ベローズ カレッジの管理担当者とセキュリティ担当者がキャンパス内の建物へのアクセスを管理および制御できるようにします。 

このラボでは、環境をセットアップし、Microsoft Dataverse データベースを作成し、変更を追跡するソリューションを作成します。また、次の要件をサポートするデータ モデルも作成します。

-   R1 – キャンパス訪問の場所 (建物) を追跡する
-   R2 – 訪問者を識別し、追跡するための基本情報を記録します 
-   R3 – 訪問をスケジュール、記録、および管理します 

最後に、サンプル データを Microsoft Dataverse にインポートします。

# ラボ手順の概要

学習環境を準備するには、次の手順を実行します。

* ソリューションと発行元を作成します
* アプリケーション要件を満たすために必要な新規コンポーネントと既存のコンポーネントの両方を追加します。メタデータの説明 (テーブルおよびリレーションシップ) については、「[データ モデル ドキュメント](https://github.com/MicrosoftLearning/PL-900-Microsoft-Power-Platform-Fundamentals/blob/master/Allfiles/Campus%20Management.png)」を参照してください。Ctrl キーを押しながらクリックするか、リンクを右クリックして、データ モデル ドキュメントを新しいウィンドウで開くことができます。

すべてのカスタマイズが完了すると、ソリューションに複数のテーブルが含まれます。

-   連絡先
-   建物
-   訪問

## 前提条件:

* **モジュール 0 ラボ 0 - ラボ環境の検証**の完了

## 始める前に考慮すべきこと

* 名前付け規則

* データ型、制限事項 (名前の最大長など)

* 簡単なローカライズをサポートする日時の書式設定

# 演習 \#1: ソリューションの作成

## タスク \#1: ソリューションと発行元を作成する

1.  ソリューションを作成します

    -   <https://make.powerapps.com"> に移動します。再認証が必要な場合は、「**サインイン**」をクリックし、必要に応じて指示に従ってください。

    -   画面の右上隅にある「**環境**」をクリックし、ドロップダウン メニューから自分の環境を選択します。

    -   左側のメニューから「**ソリューション**」を選択し、「**新しいソリューション**」をクリックします。

    -   「**表示名**」に、「**[姓] キャンパス管理**」と入力します。

2.  発行元を作成します

    -   「**発行元**」ドロップダウンをクリックし、「**+ 発行元**」を選択します

    -   ポップアップ表示されるウィンドウで、「**表示名**」に「**ベローズ カレッジ**」と入力します。 
    
    -   「**プレフィックス**」に「**bc**」と入力します

    -   「**保存して閉じる**」をクリックします
    
    -   ポップアップ ウィンドウで「**作成**」をクリックします。

3.  ソリューションの作成を完了します。

    -   次に、「**発行元**」ドロップダウンをクリックし、「**ベローズ カレッジ**」
        発行元を選択します。

    -   **バージョン**が 「**1.0.0.0**」に設定されていることを確認します。 
    
    -   「**作成**」をクリックします。

# 演習 \#2: 既存のテーブルと新しいテーブルの追加

**目的:** この演習では、ソリューションに標準の「連絡先」テーブルを追加し、「建物」と「訪問者」の新しいカスタム テーブルを作成します。 

## タスク \#1: 既存のテーブルを追加する

1.  今作成した **キャンパス管理** ソリューションをクリックして開きます。

2.  「**既存の追加**」、「**テーブル**」の順にクリックします。

3.  「**連絡先**」を見つけて選択します。

4.  「**次へ**」をクリックします。

5.  「連絡先」の下の「**コンポーネントの選択**」をクリックします。

6.  「**ビュー**」タブを選択し、「**アクティブな連絡先**」ビューを選択します。**追加**を
    クリックします。
    
7.  「**コンポーネントを選択**」を再度クリックします。

8.  「**フォーム**」タブを選択し、「**連絡先**」フォームを選択します。
    
9.  「**追加**」をクリックします。

    > **1 つのビュー** と **1 つのフォーム**が選択されている必要があります。 
    
10.  「**追加**」をもう一度クリックします。これにより、選択したビューとフォームを持つ連絡先テーブルが、新しく作成されたソリューションに追加されます。 
    
    > ソリューションに次の 1 つのテーブルが追加されました。連絡先。

## タスク #2: 新しいテーブルを作成する

1.  キャンパス管理ソリューションのブラウザーを開いたままにしてください。表示されていない場合は、次の手順でキャンパス管理ソリューションを開きます。

    * <https://make.powerapps.com> にサインインします (まだサインインしていない場合)
    
    * 「**ソリューション**」を選択し、今作成した「**[姓] キャンパス管理**」
          ソリューションをクリックして開きます。
          
2.  建物テーブルを作成します

    -   「**新規**」をクリックして「**テーブル**」を選択します。
    
    -   「**表示名**」に「**建物**」と入力します。 
    
    -   「**作成**」をクリックします。これにより、他のテーブルと列の追加を開始する間に、バックグラウンドでテーブルのプロビジョニングが開始されます。

## タスク #3: 訪問テーブルと列を作成する

**訪問**テーブルには、建物、訪問者、スケジュールされた時間、および各訪問の実際の時間を含むキャンパス訪問に関する情報が含まれます。 

訪問チェックイン プロセス中に尋ねられたときに、訪問者が簡単に入力して解釈できる一意の番号を毎回ごとの訪問に割り当てたいと思います。

> 訪問の時刻は常に建物の場所に対してローカルであり、異なるタイム ゾーンから表示しても変更してはならないため、「**タイム ゾーン非依存**」動作を使用して、日付と時刻の情報を記録します。 

1.  **キャンパス管理** ソリューションを選択します

2. 訪問テーブルを作成します

   * 「**新規**」をクリックして「**テーブル**」を選択します。
   
   * 「**表示名**」に「**訪問**」と入力します 
   
   * 「**作成**」をクリックします。これにより、他の列の追加を開始する間に、バックグラウンドでテーブルのプロビジョニングが開始されます。

3. 「開始予定」列を作成します

   * 「**列**」タブを選択して、「**列の追加**」をクリックします。
   
   * 「**表示名**」に「**開始予定**」と入力します。
   
   * 「**データ型**」の「**日付と時刻**」を選択します。
   
   * 「**必須**」で「**必須**」を選択します。
   
   * 「**詳細オプション**」セクションを展開します。
   
   * 「**動作**」で、「**タイム ゾーン非依存**」を選択します。
   
   * 「**完了**」をクリックします。

4.  「終了予定」列を作成します

    * 「**列の追加**」をクリックします。
    
    * 「**表示名**」に「**終了予定**」と入力します。
    
    * 「**データ型**」の「**日付と時刻**」を選択します。
    
    * 「**必須**」で「**必須**」を選択します。
    
    * 「**詳細オプション**」セクションを展開します。
    
    * 「**動作**」で、「**タイム ゾーン非依存**」を選択します。
    
    * 「**完了**」をクリックします。
    
5.  「実際の開始」列を作成します

    * 「**列の追加**」をクリックします。
    
    * 「**表示名**」に「**実際の開始**」と入力します。
    
    * 「**データ型**」の「**日付と時刻**」を選択します。
    
    * 「**必須**」フィールドで、これを「**任意**」のままにします。
    
    * 「**詳細オプション**」セクションを展開します。
    
    * 「**動作**」で、「**タイム ゾーン非依存**」を選択します。
    
    * 「**完了**」をクリックします。
    
6.  「実際の終了」列を作成します

    * 「**列の追加**」をクリックします。
    
    * 「**表示名**」に「**実際の終了**」と入力します。
    
    * 「**データ型**」の「**日付と時刻**」を選択します。
    
    * 「**必須**」フィールドで、これを「**任意**」のままにします。
    
    * 「**詳細オプション**」セクションを展開します。
    
    * 「**動作**」で、「**タイム ゾーン非依存**」を選択します。
    
    * 「**完了**」をクリックします。
    
7.  「コード」列を作成します

    * 「**列の追加**」をクリックします。
    
    * **表示名**に**コード**と入力します。
    
    * 「**データ型**」で「**オートナンバー**」を選択します。
    
    * 「**オートナンバー型**」に「**日付接頭辞番号**」を選択します。
    
    * 「**完了**」をクリックします。
    
8.  「**テーブルの保存**」をクリックします

# 演習 \#3: リレーションシップの作成

**目的:** この演習では、テーブル間のリレーションシップを追加します。

## タスク #1: リレーションシップを作成する

1.  **キャンパス管理** ソリューションの **訪問**テーブルを引き続き表示していることを確認します。そうでない場合は、そこに移動します。

2.  訪問と連絡先のリレーションシップを作成します

    * 「**リレーションシップ**」タブを選択します。
    
    * 「**リレーションシップの追加**」をクリックし、「**多対一**」 を選択します。
    
    * 「**関連 (1 つ) **」の「**連絡先**」を選択します 
    
    * 「**ルックアップ列の表示名**」に「**訪問者**」と入力します 
    
    * 「**完了**」をクリックします。
    
3.  訪問と建物のリレーションシップを作成します

    * 「**リレーションシップの追加**」をクリックし、「**多対一**」を選択します。
    
    * **関連する (1)** **建物**を選択する 
    
    * 「**完了**」をクリックします。
    
4.  「**テーブルの保存**」をクリックします。

5.  トップ メニューから「**ソリューション**」を選択し、「**すべて公開のカスタマイズを公開する**」をクリックします。

# 演習 \#4: データのインポート

**目的:** この演習では、サンプル データを Dataverse データベースにインポートします。

## タスク #1: ソリューションをインポートする

このタスクでは、データのインポートを完了するために必要な Power Automate フローを含むソリューションをインポートします。

1. デスクトップに **DataImport_managed.zip** ファイルを保存している必要があります。ダウンロードしていない場合は、[データ インポート ソリューション](https://github.com/MicrosoftLearning/PL-900-Microsoft-Power-Platform-Fundamentals/blob/master/Allfiles/DataImport_managed.zip?raw=true)をダウンロードしてください。

2. <https://make.powerapps.com> にサインインします。

3. 「**自分のイニシャル 練習**」環境がまだ選択されていない場合は、右上で選択します。

4. 左側のナビゲーション パネルで「**ソリューション**」を選択します。

5. 「**インポート**」をクリックしてから、「**参照**」をクリックします。デスクトップから **DataImport_managed.zip** を参照して選択し、「**次へ**」を押します。

>   次のメッセージが表示される場合があります。
>
>   ここに依存関係がありません。このソリューションをインストールする前に、次のソリューションをインストールします。
>
>   このメッセージは、データ モデルが完全でないか、
>   公開元のプレフィックスが **bc** でないか、**建物**と**訪問**テーブルの
>   名前が上記の手順で示した名前とは異なることを示しています。

6. 「**次へ**」を押します。接続を再確立するように求めるメッセージが表示されます。 

7. 「**接続の選択**」ドロップダウンを展開し、「**+ 新しい接続**」を選択します。

8. 新しいブラウザーの画面またはタブが開きます。接続を促すメッセージが表示されたら、「**作成**」を選択します。接続の作成を完了するために、必要に応じてサインインします。

9. 現在のタブを閉じて、前の「**ソリューションのインポート**」タブに戻ります。

10. 作成した接続が選択されていることを確認します。接続が表示されない場合は、「**リフレッシュ**」をクリックして接続のリストをリフレッシュします。 

11. 「**インポート**」を押します。

12. インポートが完了するまで待機します。

## タスク #2: データをインポートする  

1. 「**データ インポート**」ソリューションを開きます。

2. 「**インポートデータ**」フローの**状態**を確認します。

3. 「**状態**」が「**オフ**」の場合は、「**データのインポート**」の横にある **[...]** を選択し、「**オン**」を選択します。

   > **重要:** エラー メッセージが表示された場合は、作成したテーブルと列が上記の手順と一致していることを確認します。

4. 「**データのインポート**」コンポーネントを開きます。Power Automate の新しいタブが開きます。 

5. ポップアップが表示された場合は、「**開始**」をクリックします。 

6. 「**実行**」をクリックしてから、プロンプトが表示されたら「**フローの実行**」をクリックします。

7. 「**完了**」をクリックします。

8. フロー インスタンスが実行を完了するまで待機します。**28 日間の実行履歴**テーブルを更新して、フローがいつ実行されたかを確認できます。 

    > このフローの目的は、今後のラボのサンプル データを生成することでした。次のタスクでは、データのインポートが正常に完了したことを確認します。 

## タスク #3: データのインポートを確認する

1. 前の「Power Apps」タブに戻ります。ポップアップで「**完了**」をクリックします。 

2. 左側のナビゲーション バーで「**ソリューション**」を選択し、「**キャンパス管理**」ソリューションを開きます。

2. 「**訪問**」テーブルをクリックして開き、「**データ**」タブを選択します。

3. 右上の「**アクティブな訪問**」をクリックしてビュー セレクタを表示し、「**すべての列**」を選択します。これにより、訪問データの表示に使用されているビューが変更されます。 

    > 解像度が低く「**アクティブな訪問**」が表示されない場合は、同じ場所に目のアイコンが表示されます。

    > インポートが成功した場合は、訪問行の一覧が表示されます。

4. 「**建物**」列の任意の値をクリックし、建物フォームが別のウィンドウで開くことを確認します。 

5. 最近起動したウィンドウを閉じます。

6. 「**訪問者**」列の任意の値をクリックし (ビューを右にスクロールする必要がある場合があります)、連絡先フォームが別のウィンドウで開くことを確認します。

7. 最近起動したウィンドウを閉じます。

# 課題

* ソリューションの一部として*予定* アクティビティを使用することを検討しますか? 何が変わるでしょうか?
* 開始予定後に終了予定が来るように強制する方法とは? 
* 1 回の訪問で複数の会議のサポートを追加する方法は?
* 外部の連絡先だけでなく、内部スタッフのメンバーに対しても建物のアクセスを保護する方法は?
* 特定の建物を訪問するために、マネージメントの承認を要求する方法は? データ モデルでは、承認プロセスはどのように変わるのでしょうか?

