---
lab:
    title: 'ラボ 4: モデル駆動型アプリをビルドする方法'
    module: 'モジュール 3: Power Apps の開始'
---

# モジュール 3: Power Apps の開始
## ラボ 3: モデル駆動型アプリをビルドする方法

### 重要なお知らせ (2020 年 11 月より適用):
Common Data Service は、Microsoft Dataverse に名称が変更されました。Microsoft Dataverse の用語が一部更新されました。たとえば、エンティティ (現在は **テーブル**)、フィールド (現在は **列**)、 レコード (現在は **行**) が古くなっていることがあります。このことを念頭に置いて、ラボに取り組んでください。近いうちにコンテンツを最新の状態に更新する予定です。

詳細および対象となる用語の一覧については、[Microsoft Dataverse とは?](https://docs.microsoft.com/ja-jp/powerapps/maker/common-data-service/data-platform-intro#terminology-updates)」をご覧ください。

# シナリオ

ベローズ カレッジは、キャンパス内に複数の建物を持つ教育機関です。キャンパスの訪問者は現在、紙の日誌に記録されています。その情報は一貫して把握されておらず、キャンパス全体の訪問に関するデータを収集して分析する手段もありません。 

キャンパスの管理者は、建物へのアクセスがセキュリティ担当者によって管理され、すべての訪問者がホストによって事前に登録され、記録されることが要求される訪問者登録システムを近代化したいと考えています。

このコース全体を通して、アプリケーションを構築するとともに自動化を行って、ベローズ カレッジの管理担当者とセキュリティ担当者がキャンパス内の建物へのアクセスを管理および制御できるようにします。 

このラボでは、Power Apps のモデル駆動型アプリを作成し、バックオフィスのキャンパス スタッフがキャンパス全体の訪問レコードを管理できるようにします。

# ラボ手順の概要

モデル駆動型アプリを作成する一環として、次の手順を実行します。

-   「キャンパス管理」という名前の新しいモデル駆動型アプリを作成する

-   アプリのナビゲーションを編集して必要なテーブルを参照する

-   アプリに必要なテーブルのフォームとビューをカスタマイズする

次のコンポーネントを操作します。

- **ビュー**: ビューを使用すると、ユーザーはフォーム テーブルに既存のデータを表示できます。

- **フォーム**: ここで、ユーザーはテーブル内の新しい行を作成または更新します。

両方のコンポーネントは、より良いユーザー エクスペリエンスのためにモデル駆動型アプリに統合されます。

## 前提条件

* **モジュール 0 ラボ 0 - ラボ環境の検証**の完了
* **モジュール 2 ラボ 1 - Common Data Service の概要**の完了

## 始める前に考慮すべきこと

-   ユーザー エクスペリエンスを向上させるためにどのような変更を加える必要がありますか。

-   構築したデータ モデルに基づいて、モデル駆動型アプリに何を含める必要がありますか?
    
-   モデル駆動型アプリのサイトマップで行うことができるカスタマイズは何ですか。


# 演習 \#1: ビューとフォームのカスタマイズ

**目的:** この演習では、モデル駆動型アプリで使用されるカスタム作成されたテーブルのビューとフォームをカスタマイズします。

## タスク \#1: 訪問フォームを編集する

1.  <https://make.powerapps.com> にまだサインインしていない場合は、サインインします。

2.  「**環境**」を選択します

3.  「**ソリューション**」を選択します。

4.  **Campus Management** ソリューションをクリックして開きます。

5.  「**訪問**」エンティティをクリックして開きます。

6.  「**フォーム**」タブを選択し、「**メイン**」フォーム タイプをクリックして開きます。 

    > 既定では、フォームに次の 2 つのフィールドがあります。名前 (プライマリ フィールド) と所有者。
    
7.  「**+ フォーム フィールド**」を選択し、列をフォームにドラッグするか、列名をクリックして、「**所有者**」フィールドの下にある以下のフィールドを追加します。

    * **建物**
    * **訪問者**
    * **開始予定**
    * **終了予定**
    * **実際の開始**
    * **実際の終了** 
    
8.  「**コード**」列をドラッグして、フォーム ヘッダーにドロップします。 

    > ヘッダーはフォームの右上の領域です。フォームのフィールドを表示するには、画面の右側にある「プロパティ」パネルの最小化が必要になる場合があります。

9.  **コード** フィールドを選択したまま、「プロパティ」パネルの「**読み取り専用**」のチェックボックスをオンにします。

10.  「**所有者**」を選択します。「プロパティ」パネルで、「**フィールド ラベル**」を「**ホスト**」に変更します。

11.  右上の「**保存**」をクリックして、保存が完了するまで待ちます。

12.  右上の「**公開**」をクリックして、公開が完了するまで待ちます。

13.  画面左上の「**戻る**」をクリックします。これで、
     「訪問」エンティティの「フォーム」タブに戻ります。

## タスク \#2: 訪問ビューを編集する

このタスクでは、既定のアクティブな訪問ビューを変更し、今日の訪問の新しいビューを作成します。

1.  「**ビュー**」タブを選択し、「**アクティブな訪問**」ビューをクリックして開きます。

2.  フィールドをクリックまたはドラッグアンドドロップして、次のフィールドをビューに追加します。

    *  **コード**
    *  **訪問者**
    *  **建物**
    *  **開始予定** 
    *  **終了予定**
    
3.  「**作成日**」列をクリックし、「**削除**」を選択します。「**作成日**」フィールドがビューから削除されます。

4.  「**名前**」列をクリックし、「**削除**」を選択します。「**名前**」フィールドがビューから削除されます。

5.  右側の「プロパティ」パネルで「**並べ替え**」をクリックし、「**開始予定**」を選択します。「**開始予定**」を再度クリックして、降順に変更します。

6.  データに合わせて列幅を変更します。

7.  「**保存**」をクリックし、変更が保存されるまで待ちます。

8.  「**公開**」をクリックし、公開が完了するまで待ちます。

次に、ビューのクローンを作成して、今日の訪問のための新しいビューを作成します。

9.  「プロパティ」パネルの「**フィルターの編集**」リンクを押します。

10.  「**追加**」をクリックし、「**行の追加**」を選択します。

11.  「**開始予定**」をフィールドとして選択し、「**今日**」をドロップダウンの条件として選択します。 

12.  「**状態**」行の **[...]** をクリックし、「**削除**」をクリックします。 

13.  「**OK**」をクリックして、条件を保存します。このビューは、スケジュールされた開始日が今日のレコードのみを表示するようにフィルター処理されます。

14.  「**実際の開始**」フィールドと「**実際の終了**」フィールドをビューに追加します。 

    > **注:** ビューのステータスをフィルター処理しないため、完了した訪問を含む今日の訪問をすべて取得します。これらのフィールドは、完了した訪問と進行中の訪問を区別するのに役立ちます。

15.  「保存」ボタンの横にある**下向き矢印**をクリックし (ボタン自体を押さないように注意してください)、「**名前を付けて保存**」を選択します。

16.  名前を「**今日の訪問**」に変更し、「**保存**」を押します。

17.  「**公開**」をクリックし、公開が完了するまで待ちます。

# 演習 \#2: モデル駆動型アプリケーションの作成

**目的:** この演習では、モデル駆動型アプリを作成し、サイトマップをカスタマイズして、アプリをテストします。

> 特にサイトマップの手順で、アプリケーションの作成時に対処されていないフィールドがいくつか表示されます。ラボの実施のために、いくつかの項目をスキップしました。実際のプロジェクトでは、これらの項目に論理名を付けます。

## タスク \#1: アプリケーションを作成する

1.  キャンパス管理ソリューションをまだ開いていない場合は、このソリューションを開きます。

    -   <https://make.powerapps.com> にサインインします

    -   環境内でクリックして「**キャンパス管理**」をクリックして開きます
        ソリューションを開きます。
    
2.  モデル駆動型アプリケーションを作成します。

    -   「**新規**」をクリックし、「**アプリ**」、「**モデル駆動型アプリ**」の順にクリックします。そうすると、新しいタブが開きます。
    
    -   「名前」に、「**[姓] キャンパス管理**」と入力します。

    -   「**既存のソリューションを使用してアプリを作成する**」チェックボックスをオンにします。

    -   「**次へ**」を選択します

    -   **キャンパス管理** ソリューションを選択します
    
    -   「**完了**」をクリックします
    
3.  「**サイト マップ**」の横にある鉛筆アイコンをクリックします。

4.  既定のタイトルを編集します。

    -   「**新しい領域**」を選択します。

    -   右側のプロパティ ペインで、「新しいエリアのタイトル」を「**キャンパス**」に変更します。

    -   「**新規グループ**」を選択します。

    -   右側のプロパティ ペインで、「新しいグループのタイトル 」を「**セキュリティ**」に変更します。
    
5.  サイトマップに連絡先テーブルを追加します

    -   **新しいサブエリア**を選択します。

    -   **プロパティ**ウィンドウに移動し、「**エンティティ**」を選択します
        「**種類**」のドロップダウンから選択します。

    -   「**エンティティ**」のドロップダウンから「**連絡先**」テーブルを検索します。
    
6.  サイトマップに訪問テーブルを追加します

    -   「**セキュリティ**」グループを選択し、「**追加**」をクリックします。

    -   「**サブエリア**」を選択します。

    -   「**プロパティ**」ウィンドウに移動します。

    -   「**タイプ**」のドロップダウンから「**エンティティ**」を選択し、
        「**エンティティ**」のドロップダウンから「**訪問**」テーブルを検索します。
    
7.  サイトマップに建物テーブルを追加します

    -   「**キャンパス**」領域を選択し、「**追加**」をクリック します。
    
    -   「**グループ**」を選択します。
    
    -   「**プロパティ**」ペインで「**タイトル**」の「**設定**」に入力します。
    
    -   「**設定**」領域を選択したまま、「**追加**」をクリックします。
    
    -   「**サブエリア**」を選択します。
    
    -   「**プロパティ**」ウィンドウに移動します。
    
    -   「**タイプ**」のドロップダウンから「**エンティティ**」を選択し、「**エンティティ**」のドロップダウンから「**建物**」テーブルを検索します。

8.  「**保存**」をクリックします。変更が保存されている間、ロード画面が表示されます。

9.  「**公開**」をクリックしてサイトマップに公開し、公開が完了するまで待ちます。

10.  「**保存して閉じる**」をクリックしてサイトマップ エディターを閉じます。 

    > サイトマップに追加されたエンティティのアセットがアプリケーションに含まれていることがわかります。
     
11.  App Designer で「**保存**」をクリックします。

12.  「**検証**」をクリックして、アプリケーションで行われた変更を検証します。 

    >  これにより警告がいくつか表示されますが、エンティティの特定のビューとフォームを参照していないため、ユーザーは「**訪問**」および「**建物**」エンティティのすべてのビューとフォームにアクセスできるので無視しても構いません。
     
13. 「**公開**」をクリックします。

14.  「**保存して閉じる**」をクリックしてアプリ エディターを閉じます。

15.  「**完了**」をクリックします。

16.  「**ソリューション**」を選択し、「**すべてのカスタマイズを公開**」を選択します。

17.  「**アプリ**」を選択すると、アプリケーションが一覧表示されます。

## タスク \#2: アプリケーションをテストする

1.  アプリケーションを起動します

    -   「**アプリ**」を選択し、「**キャンパス管理**」アプリをクリックします。(最初にアプリが表示されない場合は、ブラウザーを更新する必要があります。)

    -   アプリケーションが新しいウインドウで開きます。
    
2.  新しい連絡先を作成します

    -   アプリでは**アクティブな連絡先**ビューが開くはずです

    -   トップ メニューで「**新規**」をクリックします。

    -   「**名**」に`John`、「**姓**」に`Doe` と入力します。

    -   メール アドレスに個人用**メール**を指定します。これらは将来のラボで使用します。 
    
    -   「**保存して閉じる**」をクリックします。

    -   これで、**アクティブな連絡先**ビューに作成された連絡先が表示されます。
    
3.  新しい建物を作成します

    -   サイトマップから「**建物**」を選択します。

    -   「**新規**」をクリックします。

    -   「**名前**」に`Microsoft Building`と入力します。
        
    -   「**保存して閉じる**」をクリックします。これにより、新しく作成されたレコードが
        アクティブな建物ビューに表示されます。
    
4.  新しい訪問を作成します

    -   サイトマップから「**訪問**」を選択します。
    
    -   「**新規**」をクリックします。
    
    -   次のフィールドを入力します。 
    
        -   **名前**: `New test visit`
        -   **建物**: Microsoft Building を選択します
        -   **訪問者**:John Doe を選択します
        -   **開始予定**: 開始時刻として明日の日付と午後 2 時を選択します
        -   **終了予定**: 終了時刻として明日の日付と午後 3 時 30 分を選択します。
        
    -   「**保存して閉じる**」をクリックします。これにより訪問が作成され、
        アクティブな訪問ビューで見れるようになります。
        
    -   ビューを「**今日の訪問**」に変更します。新しい訪問は明日に予定されているため、ビューに表示されなくなります。
    
5. さらにテスト レコードを追加できます。

   起動中のアプリは次のようになります。

![モデル駆動型アプリのサンプル](media/3-model-app.png)

# 課題

* 訪問と建物の特定のビューとフォームを選択します
* セキュリティ担当者は通常、1 つの建物で作業します。選択した建物の訪問者のみを表示する簡単な方法を提供するにはどうすればいいでしょうか?
* 特定のエンティティへのアクセスを制限 (たとえば、管理者を除くすべてのスタッフ メンバーに対して、建物を読み取り専用にする必要があるなど)
* どのダッシュボードをアプリに追加することを検討しますか?
